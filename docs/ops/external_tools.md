# External Tools Setup

**Version**: 0.1.0  
**Platform**: Windows 10/11  
**Last Updated**: October 22, 2025

---

## Overview

PODStudio relies on external binaries and Python packages for media processing. This doc covers installation and PATH configuration.

---

## Python Dependencies (Required for M3)

**Status:** Implemented in STEP 6

### rembg (Background Removal)

**Purpose:** AI-powered background removal for images

**Installation:**
```powershell
pip install rembg
```

**First Run:**
- U2Net model (176 MB) auto-downloads to rembg cache
- Location: `%USERPROFILE%\.u2net\` on Windows
- Subsequent runs use cached model (no download)

**Usage:** Called automatically by `run_bg_remove_job()`

**Requirements:**
- Python 3.11+
- RAM: 2-4 GB during processing
- CPU: Multi-core recommended (8+ threads)
- GPU: Optional (not yet supported in M3, future enhancement)

**Troubleshooting:**
- **"Model download failed"**: Check internet connection, verify firewall not blocking downloads
- **"Out of memory"**: Close other applications, process smaller images
- **Slow processing**: Normal for CPU mode (5-15s per image)

---

### pydub (Audio Processing)

**Purpose:** Audio loading/decoding for waveform generation

**Installation:**
```powershell
pip install pydub
```

**Dependencies:**
- Requires **FFmpeg** (see below) â€” pydub uses ffmpeg for decoding

**Usage:** Called by `run_audio_waveform_job()`

**Troubleshooting:**
- **"ffmpeg not found"**: Install FFmpeg and add to PATH
- **"Unsupported format"**: Ensure ffmpeg supports the audio codec

---

### numpy (Array Processing)

**Purpose:** Audio sample downsampling for waveforms

**Installation:**
```powershell
pip install numpy
```

**Usage:** Required by `run_audio_waveform_job()` for audio array processing

---

### Pillow (PIL) (Image Processing)

**Purpose:** Image loading, drawing, saving for background removal and waveforms

**Installation:**
```powershell
pip install Pillow
```

**Usage:** Used by both `run_bg_remove_job()` and `run_audio_waveform_job()`

---

## FFmpeg (Required)

**Purpose**: Video/audio transcoding, metadata extraction

### Installation

1. **Download**: https://www.gyan.dev/ffmpeg/builds/
   - Choose: `ffmpeg-release-essentials.zip`
2. **Extract**: `C:\ffmpeg`
3. **Add to PATH**:
   - Windows Key â†’ "Environment Variables"
   - System Variables â†’ Path â†’ Edit â†’ New
   - Add: `C:\ffmpeg\bin`
   - Click OK (restart PowerShell)

### Verification

```powershell
ffmpeg -version
# Output: ffmpeg version 6.0-...

ffprobe -version
# Output: ffprobe version 6.0-...
```

### Troubleshooting

- **"ffmpeg not recognized"**: Restart PowerShell after editing PATH
- **Missing DLLs**: Download "essentials" build (not "full" or "static")
- **Used by:** Video poster extraction (`run_video_poster_job()`), audio waveform generation (`run_audio_waveform_job()` via pydub)

---

## ExifTool (Recommended, Not Required for M3)

**Purpose**: EXIF metadata extraction from images

**Status:** Optional â€” Not used in M3 implementation

### Installation

1. **Download**: https://exiftool.org/
   - Windows Executable: `exiftool-12.50.zip`
2. **Extract**: Anywhere (e.g., `C:\Tools\exiftool`)
3. **Rename**: `exiftool(-k).exe` â†’ `exiftool.exe`
4. **Add to PATH**: Same process as FFmpeg

### Verification

```powershell
exiftool -ver
# Output: 12.50 (or current version)
```

### Troubleshooting

- **Slow first run**: ExifTool unpacks on first launch (~5 seconds)
- **Permission errors**: Run PowerShell as Administrator

---

## Real-ESRGAN (Optional, Not Implemented in M3)

**Purpose**: AI-powered 2x/4x image upscaling (GPU-accelerated)

**Status:** Planned for future milestone â€” Not used in M3

### Installation

1. **Download**: https://github.com/xinntao/Real-ESRGAN/releases
   - Windows: `realesrgan-ncnn-vulkan-<version>-windows.zip`
2. **Extract**: `PODStudio\tools\realesrgan\`
3. **Verify**: `tools\realesrgan\realesrgan-ncnn-vulkan.exe` exists
4. **No PATH needed**: PODStudio calls absolute path from `.env`

### Configuration

Edit `.env`:
```env
MEDIA_TOOLS_REALESRGAN=tools/realesrgan/realesrgan-ncnn-vulkan.exe
```

### Verification

```powershell
.\tools\realesrgan\realesrgan-ncnn-vulkan.exe
# Output: Usage: realesrgan-ncnn-vulkan -i input.jpg -o output.png ...
```

### GPU Requirements

- **Minimum**: NVIDIA GTX 1060 (6GB VRAM) or AMD equivalent
- **Recommended**: RTX 3060+ (8GB+ VRAM)
- **Fallback**: CPU mode (very slow; 10x longer)

### Troubleshooting

- **"Vulkan error"**: Update GPU drivers from NVIDIA/AMD website
- **Slow processing**: Check GPU mode with `-g 0` flag (0 = first GPU)
- **Out of memory**: Reduce batch size or use 2x instead of 4x

---

## audiowaveform (Optional, Not Implemented in M3)

**Purpose**: Generate PNG waveforms for audio files (BBC tool)

**Status:** M3 uses pydub + PIL instead â€” This tool is optional for future enhancement

**M3 Implementation:** Waveforms generated by `run_audio_waveform_job()` using:
- `pydub` for audio loading
- `numpy` for sample downsampling
- `PIL` (Pillow) for drawing waveform PNG

**Future Enhancement:** Could replace Python implementation with this faster native tool

### Installation

1. **Download**: https://github.com/bbc/audiowaveform/releases
   - Windows: `audiowaveform-<version>-win64.zip`
2. **Extract**: `C:\Tools\audiowaveform`
3. **Add to PATH**: Same process as FFmpeg

### Verification

```powershell
audiowaveform --version
# Output: audiowaveform v1.6.0
```

### Troubleshooting

- **DLL errors**: Install Visual C++ Redistributable from Microsoft

---

## Redis (Optional, Not Used in M3)

**Purpose**: Backend for RQ (task queue alternative to ThreadPoolExecutor)

**Status:** M3 uses ThreadPoolExecutor-based job queue â€” Redis/RQ planned for future milestone

### Installation (Windows Subsystem for Linux)

1. **Install WSL2**:
   ```powershell
   wsl --install
   ```
2. **Install Redis in WSL**:
   ```bash
   sudo apt update
   sudo apt install redis-server
   sudo service redis-server start
   ```
3. **Test**:
   ```bash
   redis-cli ping
   # Output: PONG
   ```

### Configuration

Edit `.env`:
```env
WORKER_BACKEND=rq
REDIS_HOST=localhost
REDIS_PORT=6379
```

### Troubleshooting

- **Connection refused**: Start Redis in WSL: `sudo service redis-server start`
- **Windows-native Redis**: Use Memurai (https://www.memurai.com/) as drop-in replacement

---

## Tool Version Matrix (M3 Status)

| Tool | Tested Version | Required? | Purpose | M3 Status |
|------|----------------|-----------|---------|-----------|
| **Python Packages** | | | | |
| rembg | 2.0.50+ | âœ… Yes (M3) | Background removal | âœ… Implemented |
| pydub | 0.25.1+ | âœ… Yes (M3) | Audio waveforms | âœ… Implemented |
| numpy | 1.24.0+ | âœ… Yes (M3) | Audio processing | âœ… Implemented |
| Pillow (PIL) | 10.0.0+ | âœ… Yes (M3) | Image processing | âœ… Implemented |
| **External Binaries** | | | | |
| FFmpeg | 6.0+ | âœ… Yes | Video/audio ops | âœ… Required |
| ExifTool | 12.50+ | Recommended | EXIF metadata | ðŸ”œ Future |
| Real-ESRGAN | 0.2.5+ | Optional | GPU upscaling | ðŸ”œ Future |
| audiowaveform | 1.6.0+ | Optional | Fast waveforms | ðŸ”œ Future |
| Redis | 7.0+ | Optional | RQ task queue | ðŸ”œ Future |

---

## Future Tools (Not Yet Supported)

- **yt-dlp**: Download reference videos (v1.1 feature)
- **ImageMagick**: Advanced image manipulation (v1.2 feature)
- **Whisper**: Audio transcription for captions (v2.0 feature)

---

**Next**: See [troubleshooting.md](troubleshooting.md) for common issues.
